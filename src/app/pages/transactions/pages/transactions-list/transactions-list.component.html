<section class="listingPageCard">
  <div class="row justify-content-between">
    <div class="col-12 col-md-6 d-flex align-items-center">
      <!-- <a class="cursor-pointer" routerLink="../">
        <img src="assets/icons/right-arrow.png" alt="Navigation back." class="arrow-icon"
          [class.rotate-arrow]="lang === 'en'" />
      </a> -->
      <p class="body-bold mb-3">
        {{ 'shared.transactions' | translate }}
      </p>
    </div>

    <div class="col-lg-6 d-flex justify-content-end" style="gap: 5px">
      <div
        *ngIf="showAdvancedSearchTable"
        class="d-flex align-items-center | cancel-advanced-search"
        (click)="onCancelAdvancedSearch()"
      >
        <img src="assets/icons/red-close.png" style="width: 24px; height: 24px" />
        <span style="color: #545961">{{ 'shared.cancelSearch' | translate }}</span>
      </div>
    </div>
  </div>

  <div>
    <!--Start table-->
    <ng-container *ngIf="showAdvancedSearchTable; else regularTable">
      <!--Start advanced search table-->
      <div class="advanced-search-table table-responsive">
        <table mat-table [dataSource]="advancedSearchSource" multiTemplateDataRows>
          <ng-container matColumnDef="transactionNumber">
            <th mat-header-cell *matHeaderCellDef>
              {{ 'shared.transactionNum' | translate }}
            </th>
            <td mat-cell *matCellDef="let element">
              {{ element.transactionNumber }}
            </td>
          </ng-container>

          <ng-container matColumnDef="title">
            <th mat-header-cell *matHeaderCellDef>
              {{ 'shared.title' | translate }}
            </th>
            <td mat-cell *matCellDef="let element">
              {{ element.title }}
            </td>
          </ng-container>

          <ng-container matColumnDef="actions">
            <th mat-header-cell *matHeaderCellDef></th>
            <td mat-cell *matCellDef="let element">
              <div class="options-container">
                <div class="d-flex justify-content-center align-items-center | options-container">
                  <div
                    class="d-flex align-items-center | watch-container"
                    matTooltip="{{
                      'TransactionsModule.TransactionsListComponent.viewTransactionDetails'
                        | translate
                    }}"
                    (click)="onViewElement(element.id)"
                  >
                    <img src="assets/icons/eye-opened.png" class="eye-opened" />
                  </div>
                </div>
              </div>
            </td>
          </ng-container>
          <tr mat-header-row *matHeaderRowDef="['transactionNumber', 'title', 'actions']"></tr>
          <tr
            mat-row
            *matRowDef="let element; columns: ['transactionNumber', 'title', 'actions']"
            class="example-element-row"
            [ngClass]="{ hide: isLoading }"
          ></tr>

          <ng-container matColumnDef="noData">
            <td
              mat-footer-cell
              *matFooterCellDef
              [attr.colspan]="['transactionNumber', 'title', 'actions'].length"
            >
              <p class="text-center">{{ 'shared.noRowsFound' | translate }}</p>
            </td>
          </ng-container>

          <!--start loading -->
          <ng-container matColumnDef="loading">
            <td
              mat-footer-cell
              *matFooterCellDef
              [attr.colspan]="return_displayed_columns().length"
            >
              <p class="text-center">{{ 'shared.loading' | translate }} ...</p>
            </td>
          </ng-container>

          <tr mat-footer-row *matFooterRowDef="['loading']" [ngClass]="{ hide: !isLoading }"></tr>
          <!--end loading -->
          <tr
            mat-footer-row
            *matFooterRowDef="['noData']"
            [ngClass]="{
              hide: isLoading || advancedSearchSource.data.length != 0
            }"
          ></tr>
        </table>
      </div>
      <!--------------End advanced search table------------------->
    </ng-container>

    <ng-template #regularTable>
      <app-filters
        [hasFiltersApplied]="isTableFiltered"
        [prioritiesList]="prioritiesList"
        (openDialog)="onOpenSearch($event)"
        (filtersChange)="onFiltersChange($event)"
      ></app-filters>

      <!--End filters-->
      <div class="mt-3">
        <app-table-list
          [className]="'primary-table'"
          [columnsConfig]="columnsConfig"
          [columns]="columns"
          [isError]="isError"
          [isLoading]="isLoading"
          [rows]="transactionsSource"
          (filterChanged)="onTableFilterChanged($event)"
          [resetTableFilters]="!isTableFiltered"
          [hasPaginator]="true"
          [pageSize]="pageSize"
          [totalElements]="totalElements"
          (pageChange)="onPaginationChange($event)"
          (customHoverShow)="
            showTargetedElement($event.event, $event.element, $event.i, $event.column)
          "
          (customHoverHide)="hideTargetedElement()"
          class="new-primary-table"
        >
        </app-table-list>
      </div>

      <div
        #transactionPopup
        *ngIf="showTransactionElement"
        class="example-element-detail"
        [ngStyle]="{
          top: transactionTargetedElement.position.top,
          left: transactionTargetedElement.position.left
        }"
        (mouseenter)="onPopupMouseEnter()"
        (mouseleave)="onPopupMouseLeave()"
      >
        <div
          class="example-element-description"
          [ngStyle]="{
            position: 'sticky',
            zIndex: 9999999,
            top: transactionTargetedElement.position.top,
            left: transactionTargetedElement.position.left
          }"
        >
          <div class="row flex-wrap justify-content-around" id="first-row">
            <div class="col-12 | single-card">
              <div class="d-flex align-items-center | title-content card-content">
                <div
                  class="d-flex align-items-center justify-content-start | info-content card-content"
                >
                  <p class="label mb-0">{{ 'shared.title' | translate }} :</p>

                  <p class="info-data mb-0" [class.orange-color]="1 === 1">
                    {{ transactionTargetedElement?.title }}
                  </p>
                </div>
              </div>
            </div>
          </div>

          <div class="row flex-wrap justify-content-around | rest-details-container">
            <div class="col-12 col-sm-6 | single-card">
              <div
                class="d-flex align-items-center justify-content-start | info-content card-content"
              >
                <p class="label">{{ 'shared.transactionNum' | translate }} :</p>

                <p class="info-data">
                  {{
                    transactionTargetedElement?.transactionNumber ||
                      transactionTargetedElement?.autoNumber | transactionNumberFormatter
                  }}
                </p>
              </div>
            </div>

            <div class="col-12 col-sm-6 | single-card">
              <div
                class="d-flex align-items-center justify-content-start | info-content card-content"
              >
                <p class="label">
                  {{ 'TransactionsModule.TransactionsListComponent.transactionStatus' | translate }}
                  :
                </p>

                <p class="info-data">
                  <ng-container
                    *ngIf="
                      transactionTargetedElement.containerStatus === RequestContainerStatus.Open
                    "
                  >
                    {{ 'TransactionsModule.TransactionsListComponent.open' | translate }}
                  </ng-container>

                  <ng-container
                    *ngIf="
                      transactionTargetedElement.containerStatus === RequestContainerStatus.Held
                    "
                  >
                    {{ 'shared.held' | translate }}
                  </ng-container>

                  <ng-container
                    *ngIf="
                      transactionTargetedElement.containerStatus ===
                      RequestContainerStatus.Scheduled
                    "
                  >
                    {{ 'TransactionsModule.TransactionsListComponent.scheduled' | translate }}
                  </ng-container>

                  <ng-container
                    *ngIf="
                      transactionTargetedElement.containerStatus === RequestContainerStatus.Reset
                    "
                  >
                    {{ 'TransactionsModule.TransactionsListComponent.reset' | translate }}
                  </ng-container>
                  <ng-container
                    *ngIf="
                      transactionTargetedElement.containerStatus === RequestContainerStatus.Close
                    "
                  >
                    {{ 'TransactionsModule.TransactionsListComponent.close' | translate }}
                  </ng-container>
                  <ng-container
                    *ngIf="
                      transactionTargetedElement.containerStatus ===
                      RequestContainerStatus.ForceClose
                    "
                  >
                    {{ 'TransactionsModule.TransactionsListComponent.forceClose' | translate }}
                  </ng-container>
                </p>
              </div>
            </div>

            <div class="col-12 col-sm-6 | single-card">
              <div
                class="d-flex align-items-center justify-content-start | info-content card-content"
              >
                <p class="label">{{ 'shared.incomingFoundation' | translate }} :</p>

                <p class="info-data">
                  {{ transactionTargetedElement?.foundation?.title }}

                  <span *ngIf="!transactionTargetedElement?.foundation" class="no-data">
                    لا يوجد</span
                  >
                </p>
              </div>
            </div>

            <div class="col-12 col-sm-6 | single-card">
              <div
                class="d-flex align-items-center justify-content-start | info-content card-content"
              >
                <p class="label">{{ 'shared.subFoundation' | translate }} :</p>

                <p class="info-data">
                  {{ transactionTargetedElement?.subFoundation?.title }}
                  <span *ngIf="!transactionTargetedElement?.subFoundation" class="no-data">
                    لا يوجد</span
                  >
                </p>
              </div>
            </div>

            <div class="col-12 col-sm-6 | single-card">
              <div
                class="d-flex align-items-center justify-content-start | info-content card-content"
              >
                <p class="label">{{ 'shared.sector' | translate }} :</p>

                <p class="info-data">
                  {{ transactionTargetedElement?.sector?.title }}
                  <span *ngIf="!transactionTargetedElement?.sector" class="no-data"> لا يوجد</span>
                </p>
              </div>
            </div>

            <div class="col-12 col-sm-6 | single-card">
              <div
                class="d-flex align-items-center justify-content-start | info-content card-content"
              >
                <p class="label">{{ 'shared.benefitType' | translate }} :</p>

                <p class="info-data">
                  {{ transactionTargetedElement?.benefitType?.title }}
                  <span *ngIf="!transactionTargetedElement?.benefitType" class="no-data">
                    لا يوجد</span
                  >
                </p>
              </div>
            </div>

            <div class="col-12 col-sm-6 | single-card">
              <div
                class="d-flex align-items-center justify-content-start | info-content card-content"
              >
                <p class="label">{{ 'shared.treatmentMechanism' | translate }} :</p>

                <p class="info-data">
                  {{ transactionTargetedElement.committee?.committeeSymbol }}
                  <span *ngIf="!transactionTargetedElement?.committee" class="no-data">
                    لا يوجد</span
                  >
                </p>
              </div>
            </div>

            <div class="col-12 col-sm-6 | single-card">
              <div
                class="d-flex align-items-center justify-content-start | info-content card-content"
              >
                <p class="label">{{ 'shared.priority' | translate }} :</p>

                <p
                  class="info-data"
                  [ngStyle]="{
                    color: transactionTargetedElement.duration?.color
                  }"
                >
                  {{ transactionTargetedElement.priority?.title }}
                  <span *ngIf="!transactionTargetedElement?.priority" class="no-data">
                    لا يوجد</span
                  >
                </p>
              </div>
            </div>

            <div class="col-12 mb-0 | single-card">
              <div
                *ngIf="!transactionTargetedElement.isExtendRequest"
                class="d-flex align-items-center mt-2 | title-content card-content"
              >
                <div class="transactionSubHeader">
                  <p class="body-bold">
                    {{ 'ImportsExportsModule.AddImportComponent.costsRequestedAmount' | translate }}
                  </p>

                  <p class="data amounts-paragraph" [class.orange-color]="1 === 1">
                    <span>
                      <span class="grey-color">{{ 'shared.totalAllocations' | translate }} : </span>
                      <span style="display: block">
                        {{
                          transactionTargetedElement?.creditsApprovedAmount != null
                            ? (transactionTargetedElement?.creditsApprovedAmount
                              | currency : ' ' : 'symbol' : '1.2-2')
                            : '0.00'
                        }}
                        <img
                          src="assets/icons/new-sar.svg"
                          style="width: 24px; height: 24px; display: inline-block"
                        />
                      </span>

                      <!-- <span *ngIf="element?.creditsRequestedAmount === null" class="no-data">
                        لايوجد</span
                      > -->
                    </span>

                    <span>
                      <span class="grey-color">{{ 'shared.totalCosts' | translate }} : </span>
                      <span style="display: block">
                        {{
                          transactionTargetedElement?.costsApprovedAmount != null
                            ? (transactionTargetedElement?.costsApprovedAmount
                              | currency : ' ' : 'symbol' : '1.2-2')
                            : '0.00'
                        }}
                        <img
                          src="assets/icons/new-sar.svg"
                          style="width: 24px; height: 24px; display: inline-block"
                        />
                      </span>
                    </span>
                  </p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </ng-template>
  </div>
</section>
